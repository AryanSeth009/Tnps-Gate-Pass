<div class="container-fluid">
    <div class="row">
        <div class="col-md-3"><div class="card p-3 shadow-sm bg-primary text-white"><h5>Total Students</h5><h3><%= stats.attendance.Total %></h3></div></div>
        <div class="col-md-3"><div class="card p-3 shadow-sm bg-success text-white"><h5>Inside Hostel</h5><h3><%= stats.attendance.Present %></h3></div></div>
        </div>

    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card p-3">
                <h6>Department Distribution</h6>
                <canvas id="deptChart"></canvas>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card p-3">
                <h6>Hourly Pass Generation</h6>
                <canvas id="hourlyChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    async function loadCharts() {
        const res = await fetch('/api/dashboard-stats');
        const data = await res.json();

        // Render Dept Pie Chart
        new Chart(document.getElementById('deptChart'), {
            type: 'pie',
            data: {
                labels: data.deptDist.map(row => row.label),
                datasets: [{ data: data.deptDist.map(row => row.value), backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e'] }]
            }
        });

        // Render Hourly Line Chart
        new Chart(document.getElementById('hourlyChart'), {
            type: 'line',
            data: {
                labels: data.passHourly.map(row => row.label + ":00"),
                datasets: [{ label: 'Passes Generated', data: data.passHourly.map(row => row.value), borderColor: '#4e73df', fill: true }]
            }
        });
    }
    loadCharts();
</script>